import yaml
from fastapi import FastAPI
from pydantic import BaseModel

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
app = FastAPI()


"""
=====================
–ú–æ–¥–µ–ª–∏ –∑–∞–ø—Ä–æ—Å–∞ –∏ –æ—Ç–≤–µ—Ç–∞

–ú–æ–¥–µ–ª—å ‚Äî —ç—Ç–æ Python-–∫–ª–∞—Å—Å, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç pydantic.BaseModel –∏ –æ–ø–∏—Å—ã–≤–∞–µ—Ç, –∫–∞–∫–∏–µ –ø–æ–ª—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ –¥–∞–Ω–Ω—ã—Ö, –∫–∞–∫–∏–µ —É –Ω–∏—Ö —Ç–∏–ø—ã, –∏ –∫–∞–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è.

FastAPI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
* –ü—Ä–æ–≤–µ—Ä–∏—Ç, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —ç—Ç–∏–º —Ç–∏–ø–∞–º.
* –°–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –¥–ª—è Swagger UI.
* –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –æ–±—ä–µ–∫—Ç Python

–ú–æ–¥–µ–ª–∏ –æ—Ç–¥–µ–ª—è—é—Ç –ª–æ–≥–∏–∫—É —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏ –æ—Ç –ª–æ–≥–∏–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤. –ö–æ–¥ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∞–∫–∫—É—Ä–∞—Ç–Ω—ã–º –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–º.
=====================
"""

# –ø—Ä–∏–º–µ—Ä –º–æ–¥–µ–ª–∏: –æ–ø–∏—Å—ã–≤–∞–µ—Ç, —á—Ç–æ –∫–ª–∏–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –æ—Ç–ø—Ä–∞–≤–∏—Ç—å.
class UserRequest(BaseModel):
    name: str
    age: int

# –æ–ø–∏—Å—ã–≤–∞–µ—Ç, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—ë—Ç
class UserResponse(BaseModel):
    message: str


# —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞ –±—É–¥–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–µ—Ä–∞
@app.on_event("startup")
async def generate_openapi_yaml():
    # –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ –¥–ª—è API –≤ yaml
    openapi_schema = app.openapi()
    with open("openapi.yaml", "w") as f:
        yaml.dump(openapi_schema, f, default_flow_style=False, allow_unicode=True)
    print("OpenAPI YAML —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å–µ—Ä–≤–µ—Ä–∞!")
    

# =====================
#  –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã
# =====================

@app.post("/greet", response_model=UserResponse,  summary="–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")
async def greet_user(user: UserRequest) -> UserResponse:
    """
    –ü–æ–ª—É—á–∞–µ—Ç –∏–º—è –∏ –≤–æ–∑—Ä–∞—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ.
    """
    # –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –∑–µ–º–Ω—ã–µ –≥–æ–¥—ã –≤ –º–∞—Ä—Å–∏–∞–Ω—Å–∫–∏–µ
    years_mars = user.age * 1.88
    return UserResponse(message=f"–ü—Ä–∏–≤–µ—Ç, {user.name}! –¢–µ–±–µ {years_mars} –º–∞—Ä—Å–∏–∞–Ω—Å–∫–∏—Ö –ª–µ—Ç.")


# =====================
#  –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
# =====================
# uvicorn main:app --reload --port 8888

# –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ —Å–ª–µ–¥—É—é—â–∏–º –∞–¥—Ä–µ—Å–∞–º:
# Swagger UI:
# üìå http://127.0.0.1:8888/docs ‚Äî –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è.
# –¢–∞–º –º–æ–∂–Ω–æ —Å—Ä–∞–∑—É –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã, –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ—Ç–≤–µ—Ç—ã.

# ReDoc:
# üìå http://127.0.0.1:8888/redoc ‚Äî –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è, –±–æ–ª–µ–µ –º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è.

# –§–∞–π–ª OpenAPI:
# üìå http://127.0.0.1:8888/openapi.json ‚Äî –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON.